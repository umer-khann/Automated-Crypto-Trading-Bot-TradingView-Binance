//@version=5
strategy("Automated Trading Bot Strategy", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// ============================================================================
// INPUT PARAMETERS
// ============================================================================
rsi_length = input.int(14, title="RSI Length", minval=1)
rsi_overbought = input.int(70, title="RSI Overbought", minval=50, maxval=100)
rsi_oversold = input.int(30, title="RSI Oversold", minval=0, maxval=50)

ema_fast = input.int(12, title="Fast EMA", minval=1)
ema_slow = input.int(26, title="Slow EMA", minval=1)

macd_fast = input.int(12, title="MACD Fast", minval=1)
macd_slow = input.int(26, title="MACD Slow", minval=1)
macd_signal = input.int(9, title="MACD Signal", minval=1)

bb_length = input.int(20, title="Bollinger Bands Length", minval=1)
bb_mult = input.float(2.0, title="Bollinger Bands Multiplier", minval=0.1)

// ============================================================================
// TECHNICAL INDICATORS
// ============================================================================

// RSI
rsi = ta.rsi(close, rsi_length)

// EMA Crossover
ema_fast_line = ta.ema(close, ema_fast)
ema_slow_line = ta.ema(close, ema_slow)

// MACD
[macd_line, signal_line, hist_line] = ta.macd(close, macd_fast, macd_slow, macd_signal)

// Bollinger Bands
[bb_upper, bb_middle, bb_lower] = ta.bb(close, bb_length, bb_mult)

// ============================================================================
// SIGNAL CONDITIONS
// ============================================================================

// Buy Conditions (all must be true for a buy signal)
ema_bullish = ta.crossover(ema_fast_line, ema_slow_line)
macd_bullish = macd_line > signal_line and macd_line[1] <= signal_line[1]
rsi_bullish = rsi < rsi_oversold or (rsi > rsi_oversold and rsi < 50)
bb_bullish = close <= bb_lower or (close < bb_middle and close > bb_lower)

buy_signal = ema_bullish and macd_bullish and rsi_bullish and bb_bullish

// Sell Conditions (all must be true for a sell signal)
ema_bearish = ta.crossunder(ema_fast_line, ema_slow_line)
macd_bearish = macd_line < signal_line and macd_line[1] >= signal_line[1]
rsi_bearish = rsi > rsi_overbought or (rsi < rsi_overbought and rsi > 50)
bb_bearish = close >= bb_upper or (close > bb_middle and close < bb_upper)

sell_signal = ema_bearish and macd_bearish and rsi_bearish and bb_bearish

// ============================================================================
// STRATEGY EXECUTION
// ============================================================================

if (buy_signal)
    strategy.entry("Long", strategy.long, comment="Buy Signal")
    
if (sell_signal)
    strategy.close("Long", comment="Sell Signal")

// ============================================================================
// PLOTTING
// ============================================================================

// Plot EMAs
plot(ema_fast_line, color=color.blue, title="Fast EMA", linewidth=2)
plot(ema_slow_line, color=color.red, title="Slow EMA", linewidth=2)

// Plot Bollinger Bands
plot(bb_upper, color=color.gray, title="BB Upper", linewidth=1)
plot(bb_middle, color=color.orange, title="BB Middle", linewidth=1)
plot(bb_lower, color=color.gray, title="BB Lower", linewidth=1)

// Plot Buy/Sell Signals
plotshape(buy_signal, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small, title="Buy Signal")
plotshape(sell_signal, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small, title="Sell Signal")

// ============================================================================
// ALERT CONDITIONS
// ============================================================================

// Alert message with JSON payload
// IMPORTANT: Fire alert when signal occurs, not just when order executes
if (buy_signal)
    alert('{"signal": "buy", "symbol": "' + syminfo.ticker + '", "price": ' + str.tostring(close) + ', "time": "' + str.tostring(time) + '"}', alert.freq_once_per_bar)

if (sell_signal)
    alert('{"signal": "sell", "symbol": "' + syminfo.ticker + '", "price": ' + str.tostring(close) + ', "time": "' + str.tostring(time) + '"}', alert.freq_once_per_bar)

// Alternative: Fire alert on bar close if signal is true (more reliable)
if (barstate.isconfirmed and buy_signal)
    alert('{"signal": "buy", "symbol": "' + syminfo.ticker + '", "price": ' + str.tostring(close) + ', "time": "' + str.tostring(time) + '"}', alert.freq_once_per_bar)

if (barstate.isconfirmed and sell_signal)
    alert('{"signal": "sell", "symbol": "' + syminfo.ticker + '", "price": ' + str.tostring(close) + ', "time": "' + str.tostring(time) + '"}', alert.freq_once_per_bar)

